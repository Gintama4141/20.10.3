<!DOCTYPE html>
<html lang="en">
<head>
  <title>Network Monitor</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  
  <script src="http://192.168.1.1:19999/dashboard.js"></script>
  <script>var netdataTheme='white',netdataPrepCallback=function(){NETDATA.requiredCSS=[]}</script>

<style>
:root{
  --p:#667eea;--s:#764ba2;--a:#f093fb;--g:#10b981;--w:#f59e0b;--d:#ef4444;
  --bg:#e0e5ec;--bg2:#e0e5ec;--bg3:#e0e5ec;--txt-stats:#2d3748;
  --t1:#2d3748;--t2:#718096;--t3:#a0aec0;--b1:#d1d9e6;--b2:#ffffff;
  --sh-out:6px 6px 12px #bebebe, -6px -6px 12px #ffffff;
  --sh-in:inset 4px 4px 8px #bebebe, inset -4px -4px 8px #ffffff;
  --sh-btn:3px 3px 6px #bebebe, -3px -3px 6px #ffffff;
  --radius:16px;--font-body:'Inter',sans-serif;
}

[data-theme="dark"]{
  --bg:#2d3748;--bg2:#1a202c;--bg3:#2d3748;--txt-stats:#f7fafc;
  --t1:#ffd700;--t2:#ffffff;--t3:#a0aec0;--b1:#4a5568;--b2:#1a202c;
  --sh-out:6px 6px 12px #151a20, -6px -6px 12px #1f252e;
  --sh-in:inset 4px 4px 8px #151a20, inset -4px -4px 8px #1f252e;
  --sh-btn:3px 3px 6px #151a20, -3px -3px 6px #1f252e;
  --p:#00ff00;
}

[data-theme="ocean"]{
  --bg:#0f172a;--bg2:#0f172a;--bg3:#0f172a;--txt-stats:#e2e8f0;
  --t1:#ffd700;--t2:#ffffff;--t3:#64748b;--b1:#334155;--b2:#020617;
  --sh-out:6px 6px 12px #070b14, -6px -6px 12px #172340;
  --sh-in:inset 4px 4px 8px #070b14, inset -4px -4px 8px #172340;
  --sh-btn:3px 3px 6px #070b14, -3px -3px 6px #172340;
  --p:#00ff00;--s:#06b6d4;--a:#0ea5e9;--g:#22d3ee;
}

[data-theme="purple"]{
  --bg:#1e1b4b;--bg2:#1e1536;--bg3:#312e81;--txt-stats:#f8fafc;
  --t1:#ffd700;--t2:#ffffff;--t3:#c7d2fe;--b1:#4338ca;--b2:#0f0d2b;
  --sh-out:6px 6px 12px #0f0d2b, -6px -6px 12px #2d296b;
  --sh-in:inset 4px 4px 8px #0f0d2b, inset -4px -4px 8px #2d296b;
  --sh-btn:3px 3px 6px #0f0d2b, -3px -3px 6px #2d296b;
  --p:#00ff00;--s:#a855f7;--a:#c084fc;
}

[data-theme="gradient"]{
  --bg:linear-gradient(135deg,#667eea,#764ba2);--bg2:#667eea;--bg3:#667eea;--txt-stats:#ffffff;
  --t1:#ffd700;--t2:#ffffff;--t3:#e8eeff;--b1:#5a72e6;--b2:#7289ed;
  --sh-out:6px 6px 12px #5670e0, -6px -6px 12px #768cf4;
  --sh-in:inset 4px 4px 8px #5670e0, inset -4px -4px 8px #768cf4;
  --sh-btn:3px 3px 6px #5670e0, -3px -3px 6px #768cf4;
  --p:#00ff00;
}

[data-theme="transparent"]{
  --bg:rgba(240,242,245,0.9);--bg2:rgba(255,255,255,0.8);--bg3:rgba(255,255,255,0.9);--txt-stats:#000000;
  --t1:#000000;--t2:#2d3748;--t3:#4a5568;--b1:rgba(209,217,230,0.5);--b2:rgba(255,255,255,0.3);
  --sh-out:6px 6px 12px rgba(209,217,230,0.4), -6px -6px 12px rgba(255,255,255,0.8);
  --sh-in:inset 4px 4px 8px rgba(209,217,230,0.3), inset -4px -4px 8px rgba(255,255,255,0.7);
  --sh-btn:3px 3px 6px rgba(209,217,230,0.3), -3px -3px 6px rgba(255,255,255,0.6);
}

*{margin:0;padding:0;box-sizing:border-box}
html{font-size:16px;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}
body{
  font:400 1rem/1.4 var(--font-body);background:var(--bg);min-height:100vh;color:var(--t1);
  transition:background 0.3s,color 0.3s;position:relative;overflow-x:hidden;
  -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;width:100%;
}

[data-theme="transparent"] body{
  background:linear-gradient(135deg,rgba(102,126,234,0.1),rgba(118,75,162,0.08)),#f8fafc;
}

.container{max-width:1200px;margin:0 auto;padding:1rem;width:100%}

.blur-overlay{
  position:fixed;top:0;left:0;width:100vw;height:100vh;
  background:rgba(0,0,0,0.4);z-index:998;opacity:0;visibility:hidden;
  transition:opacity 0.4s ease;
}
.blur-overlay.active{opacity:1;visibility:visible}

.top-ctrl{
  position:fixed;top:1rem;right:1rem;z-index:1001;
  display:flex;align-items:center;gap:0.5rem;
}

.ctrl-toggle{
  background:var(--bg3);color:var(--t1);border:none;border-radius:50%;
  width:2.5rem;height:2.5rem;cursor:pointer;box-shadow:var(--sh-btn);
  font-size:1rem;transition:all 0.2s;display:flex;align-items:center;justify-content:center;
}
.ctrl-toggle:hover{box-shadow:var(--sh-in);transform:scale(0.95)}

.ctrl-buttons{
  display:flex;gap:0.5rem;transition:all 0.3s;
  transform:translateX(0);opacity:1;
}
.ctrl-buttons.hidden{transform:translateX(200px);opacity:0}

.btn{
  background:var(--bg3);border:none;border-radius:var(--radius);padding:0.5rem 0.75rem;
  cursor:pointer;box-shadow:var(--sh-btn);color:var(--t1);font:600 0.75rem var(--font-body);
  transition:all 0.2s;min-width:4rem;text-align:center;white-space:nowrap;
  height:2.5rem;display:flex;align-items:center;justify-content:center;
}
.btn:hover{box-shadow:var(--sh-in);transform:scale(0.98)}
.btn.stats.active{box-shadow:var(--sh-in);color:var(--g);transform:scale(0.98)}

.toast{
  position:fixed;top:4rem;right:1rem;z-index:2000;background:var(--bg3);
  border-radius:var(--radius);padding:0.75rem 1rem;box-shadow:var(--sh-out);
  font:600 0.75rem var(--font-body);transform:translateX(300px);opacity:0;
  transition:all 0.3s;min-width:12rem;
}
.toast.show{transform:translateX(0);opacity:1}
.toast.success{color:var(--g)}
.toast.error{color:var(--d)}

.header{
  text-align:center;margin-bottom:1rem;padding:1rem;background:var(--bg2);
  border-radius:var(--radius);box-shadow:var(--sh-out);
}
.header h1{
  font:600 1.25rem var(--font-body);margin-bottom:0.25rem;
  background:linear-gradient(135deg,var(--p),var(--s));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
}
.header .subtitle{font-size:0.875rem;color:var(--t2)}

.section{
  background:var(--bg2);border-radius:var(--radius);padding:1.25rem;
  margin-bottom:1.25rem;box-shadow:var(--sh-out);
}
.title{
  text-align:center;font:600 1.125rem var(--font-body);color:var(--t1);margin-bottom:1.25rem;
}
.subtitle{color:var(--txt-stats);font-size:1rem;text-align:center}

.stats-modal{
  position:fixed;top:4rem;left:50%;transform:translateX(-50%) translateY(100vh);
  width:min(95vw,75rem);max-height:85vh;overflow-y:auto;
  background:var(--bg2);border-radius:var(--radius);padding:1.5rem;
  box-shadow:var(--sh-out);z-index:999;opacity:0;visibility:hidden;
  transition:all 0.4s cubic-bezier(0.25,0.46,0.45,0.94);
}
.stats-modal.show{opacity:1;visibility:visible;transform:translateX(-50%) translateY(0)}
.stats-modal .title{color:var(--t1);font-weight:700}
.stats-modal .subtitle{color:var(--t2)}

.close-btn{
  position:absolute;top:0.75rem;right:1rem;background:var(--bg3);border:none;
  font-size:1.25rem;color:var(--t2);cursor:pointer;padding:0.5rem;
  border-radius:50%;box-shadow:var(--sh-btn);transition:all 0.2s;width:2.5rem;height:2.5rem;
}
.close-btn:hover{box-shadow:var(--sh-in);color:var(--d);transform:scale(0.95)}

.grid-info{display:grid;grid-template-columns:repeat(3,1fr);gap:0.75rem;margin-bottom:1.25rem}
.grid-charts{display:grid;grid-template-columns:repeat(4,1fr);gap:0.75rem;margin-bottom:1.25rem}

.charts2-container{
  position:relative;margin-bottom:1rem;background:var(--bg3);
  border-radius:var(--radius);padding:0.75rem;box-shadow:var(--sh-in);
}

.grid-charts2{
  display:flex;overflow-x:auto;gap:0.75rem;padding:0.25rem;
  scroll-behavior:smooth;scroll-snap-type:x mandatory;
}

.grid-charts2::-webkit-scrollbar{height:4px}
.grid-charts2::-webkit-scrollbar-track{background:transparent}
.grid-charts2::-webkit-scrollbar-thumb{background:var(--p);border-radius:2px}

.grid-btns{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin-bottom:1.5rem}

.chart{
  background:var(--bg3);border-radius:var(--radius);padding:0.75rem;
  box-shadow:var(--sh-out);min-height:7rem;display:flex;
  align-items:center;justify-content:center;
}

.grid-charts2 .chart{
  min-height:5rem;padding:0.5rem;flex:0 0 calc(25% - 0.5625rem);
  scroll-snap-align:start;box-shadow:var(--sh-btn);
}

.info{
  background:var(--bg3);border-radius:var(--radius);padding:1rem;
  box-shadow:var(--sh-out);min-height:5rem;display:flex;
  flex-direction:column;justify-content:center;align-items:center;text-align:center;
}
.info-title{
  font:600 0.75rem var(--font-body);color:var(--t2);text-transform:uppercase;
  letter-spacing:0.05em;margin-bottom:0.25rem;
}
.info-value{font:600 0.875rem var(--font-body);color:var(--t1)}

.chart-btn{
  background:var(--bg3);color:var(--t1);border:none;
  padding:0.875rem 1rem;border-radius:var(--radius);cursor:pointer;
  font:800 0.75rem var(--font-body);text-transform:uppercase;
  letter-spacing:0.05em;box-shadow:var(--sh-btn);transition:all 0.2s;
}
.chart-btn:hover{
  box-shadow:var(--sh-in);transform:scale(0.98);
  color:var(--p);
}
.chart-btn.active{
  box-shadow:var(--sh-in);background:var(--bg3);color:var(--p);
  transform:scale(0.98);font-weight:900;
}

.img-cnt{
  position:relative;width:100%;background:var(--bg3);border-radius:var(--radius);
  box-shadow:var(--sh-in);padding:1.5rem;margin:0 auto;
}
.chart-img{display:none;width:100%;height:auto;border-radius:calc(var(--radius)/2)}
.img-cnt::before{
  content:'';position:absolute;top:50%;left:50%;width:2rem;height:2rem;
  margin:-1rem 0 0 -1rem;border:3px solid var(--t3);
  border-top-color:var(--p);border-radius:50%;animation:spin 0.8s linear infinite;
  opacity:0;z-index:2;
}
.img-cnt.loading::before{opacity:1}

@keyframes spin{to{transform:rotate(360deg)}}

@media(min-width:769px){
  .stats-modal{top:3rem;max-height:90vh}
}

@media(max-width:768px){
  html{font-size:14px}
  .container{padding:0.75rem}
  .section{padding:1rem}
  .stats-modal{width:95vw;padding:1.25rem;top:2rem;max-height:85vh}
  .grid-info,.grid-charts{gap:0.5rem}
  .grid-charts{grid-template-columns:repeat(2,1fr)}
  .info{padding:0.75rem;min-height:4.5rem}
  .chart{padding:0.5rem;min-height:6rem}
  .grid-charts2{display:grid;grid-template-columns:repeat(3,1fr);gap:0.5rem;overflow:visible}
  .grid-charts2 .chart{flex:none;width:auto;min-height:4.5rem}
  .top-ctrl{top:0.75rem;right:0.75rem;gap:0.375rem}
  .toast{top:3rem;right:0.75rem}
}

@media(max-width:480px){
  html{font-size:13px}
  .btn,.chart-btn{padding:0.625rem 0.875rem;font-size:0.7rem}
  .header{padding:0.75rem}
  .info-title{font-size:0.6875rem}
  .info-value{font-size:0.75rem}
  .grid-btns{grid-template-columns:repeat(2,1fr)}
  .stats-modal{top:1.5rem}
  .btn{height:2rem;min-width:3rem;padding:0.375rem 0.5rem}
  .ctrl-toggle{width:2rem;height:2rem;font-size:0.875rem}
}

@media(max-width:360px){
  html{font-size:12px}
  .container{padding:0.5rem}
  .section{padding:0.75rem}
  .stats-modal{padding:1rem;top:1rem}
  .grid-info{grid-template-columns:1fr 1fr 1fr}
  .info{padding:0.5rem;min-height:4rem}
  .chart{padding:0.375rem;min-height:5rem}
  .grid-charts2 .chart{min-height:4rem;padding:0.25rem}
}
</style>
</head>

<body>
  <div class="blur-overlay" id="blurOverlay"></div>

  <div class="main-content">
    <div class="container">
      <div class="top-ctrl">
        <div class="ctrl-buttons" id="ctrlButtons">
          <button class="btn" id="themeBtn"><span id="themeText">Light</span></button>
          <button class="btn stats" id="statsBtn">Statistics</button>
        </div>
        <button class="ctrl-toggle" id="ctrlToggle">⚙</button>
      </div>

      <div class="toast" id="toast">
        <span id="toastMsg"></span>
      </div>

      <header class="header">
        <h1>Network Monitor</h1>
        <p class="subtitle">Real-time Performance Dashboard</p>
      </header>

      <section class="section">
        <h2 class="title">Network Performance Metrics</h2>
        
        <div class="grid-info">
          <div class="info">
            <div class="info-title">Date</div>
            <div id="currentDate" class="info-value">Loading...</div>
          </div>
          <div class="info">
            <div class="info-title">Time</div>
            <div id="currentTime" class="info-value">Loading...</div>
          </div>
          <div class="info">
            <div class="info-title">Day</div>
            <div id="currentDay" class="info-value">Loading...</div>
          </div>
        </div>
        
        <div class="grid-charts">
          <div class="chart">
            <div data-netdata="net.eth1" data-title="MODEM" data-chart-library="gauge" data-after="-100" data-width="100%" data-points="720" data-gauge-generate-gradient="[0,5,10,60,100]" data-gauge-gradient-percent-color-0="#fa709a" data-gauge-gradient-percent-color-5="#fa709a" data-gauge-gradient-percent-color-10="#f093fb" data-gauge-gradient-percent-color-60="#4facfe" data-gauge-gradient-percent-color-100="#43e97b" data-colors="#667eea"></div>
          </div>
          <div class="chart">
            <div data-netdata="net.wwan0" data-title="RAKITAN" data-chart-library="gauge" data-after="-100" data-width="100%" data-points="720" data-gauge-generate-gradient="[0,5,10,60,100]" data-gauge-gradient-percent-color-0="#fa709a" data-gauge-gradient-percent-color-5="#fa709a" data-gauge-gradient-percent-color-10="#f093fb" data-gauge-gradient-percent-color-60="#4facfe" data-gauge-gradient-percent-color-100="#43e97b" data-colors="#f093fb"></div>
          </div>
          <div class="chart">
            <div data-netdata="net.usb0" data-title="HP" data-chart-library="gauge" data-after="-100" data-width="100%" data-points="720" data-gauge-generate-gradient="[0,5,10,60,100]" data-gauge-gradient-percent-color-0="#fa709a" data-gauge-gradient-percent-color-5="#fa709a" data-gauge-gradient-percent-color-10="#f093fb" data-gauge-gradient-percent-color-60="#4facfe" data-gauge-gradient-percent-color-100="#43e97b" data-colors="#43e97b"></div>
          </div>
          <div class="chart">
            <div data-netdata="net.br-lan" data-title="LAN" data-chart-library="gauge" data-after="-150" data-width="100%" data-points="720" data-colors="#667eea"></div>
          </div>
        </div>

        <div class="charts2-container">
          <div class="grid-charts2">
            <div class="chart">
              <div data-netdata="system.net" data-dimensions="received" data-chart-library="easypiechart" data-title="RECEIVED" data-width="100%" data-points="720" data-common-units="system.net.mainhead" data-colors="#4facfe"></div>
            </div>
            <div class="chart">
              <div data-netdata="system.net" data-dimensions="sent" data-chart-library="easypiechart" data-title="SENT" data-width="100%" data-points="720" data-common-units="system.net.mainhead" data-colors="#f093fb"></div>
            </div>
            <div class="chart">
              <div data-netdata="system.ram" data-dimensions="used|buffers|active|wired" data-chart-library="easypiechart" data-title="RAM" data-width="100%" data-points="720" data-colors="#667eea"></div>
            </div>
            <div class="chart">
              <div data-netdata="system.cpu" data-chart-library="easypiechart" data-title="CPU" data-units="%" data-easypiechart-max-value="100" data-width="100%" data-points="720" data-colors="#43e97b"></div>
            </div>
            <div class="chart">
              <div data-netdata="system.load" data-chart-library="easypiechart" data-title="LOAD" data-width="100%" data-points="720" data-colors="#ef4444"></div>
            </div>
            <div class="chart">
              <div data-netdata="netfilter.conntrack_sockets" data-chart-library="easypiechart" data-title="CONNECTIONS" data-width="100%" data-points="720" data-colors="#fbbf24"></div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <div class="stats-modal" id="statsModal">
    <button class="close-btn" id="closeBtn">×</button>
    
    <h2 class="title">Network Statistics</h2>
    <p class="subtitle" style="margin-bottom:1.25rem;">Historical network usage data</p>
    
    <div class="grid-btns">
      <button class="chart-btn active" data-chart="summary">Summary</button>
      <button class="chart-btn" data-chart="minutes">5 Minutes</button>
      <button class="chart-btn" data-chart="hourly">Hourly</button>
      <button class="chart-btn" data-chart="daily">Daily</button>
      <button class="chart-btn" data-chart="monthly">Monthly</button>
      <button class="chart-btn" data-chart="yearly">Yearly</button>
    </div>
    
    <div class="img-cnt" id="imageContainer">
      <img id="summary" class="chart-img" src="vnstati/br-lan_vnstat_s.png" alt="Network Summary" style="display:block">
      <img id="minutes" class="chart-img" src="vnstati/br-lan_vnstat_5.png" alt="5 Minutes Stats">
      <img id="hourly" class="chart-img" src="vnstati/br-lan_vnstat_h.png" alt="Hourly Stats">
      <img id="daily" class="chart-img" src="vnstati/br-lan_vnstat_d.png" alt="Daily Stats">
      <img id="monthly" class="chart-img" src="vnstati/br-lan_vnstat_m.png" alt="Monthly Stats">
      <img id="yearly" class="chart-img" src="vnstati/br-lan_vnstat_y.png" alt="Yearly Stats">
    </div>
  </div>

<script>
let buttonsVisible=localStorage.getItem('buttonsVisible')!=='false';
let currentTheme=localStorage.getItem('theme')||'light';
let activeChart='summary';
let showHijri=false;

const themes={light:'Light',dark:'Dark',ocean:'Ocean',purple:'Purple',gradient:'Gradient',transparent:'Glass'};
const dayNames=['Minggu','Senin','Selasa','Rabu','Kamis','Jumat','Sabtu'];

document.addEventListener('DOMContentLoaded',function(){
  document.body.setAttribute('data-theme',currentTheme);
  document.getElementById('themeText').textContent=themes[currentTheme];
  
  const ctrlButtons=document.getElementById('ctrlButtons');
  if(!buttonsVisible)ctrlButtons.classList.add('hidden');
  
  document.getElementById('ctrlToggle').addEventListener('click',()=>{
    buttonsVisible=!buttonsVisible;
    ctrlButtons.classList.toggle('hidden',!buttonsVisible);
    localStorage.setItem('buttonsVisible',buttonsVisible);
  });
  
  document.getElementById('themeBtn').addEventListener('click',()=>{
    const themeKeys=Object.keys(themes);
    const currentIndex=themeKeys.indexOf(currentTheme);
    const nextIndex=(currentIndex+1)%themeKeys.length;
    currentTheme=themeKeys[nextIndex];
    document.body.setAttribute('data-theme',currentTheme);
    document.getElementById('themeText').textContent=themes[currentTheme];
    localStorage.setItem('theme',currentTheme);
    showToast(`Theme: ${themes[currentTheme]}`,'success');
  });
  
  document.getElementById('statsBtn').addEventListener('click',toggleModal);
  document.getElementById('closeBtn').addEventListener('click',closeModal);
  document.getElementById('blurOverlay').addEventListener('click',closeModal);
  
  document.querySelectorAll('.chart-btn').forEach(btn=>{
    btn.addEventListener('click',(e)=>{
      const chart=e.target.getAttribute('data-chart');
      if(chart)switchChart(chart);
    });
  });
  
  updateDateTime();
  setInterval(updateDateTime,1000);
});

function toHijri(date){
  const HIJRI_EPOCH=new Date(622,6,16);
  const daysDiff=Math.floor((date-HIJRI_EPOCH)/(1000*60*60*24));
  const hijriYear=Math.floor(daysDiff/354.367)+1;
  const dayOfYear=Math.floor(daysDiff-((hijriYear-1)*354.367));
  
  const monthDays=[30,29,30,29,30,29,30,29,30,29,30,29];
  const leapYears=[2,5,7,10,13,16,18,21,24,26,29];
  if(leapYears.includes(hijriYear%30)){
    monthDays[11]=30;
  }
  
  let currentDay=dayOfYear;
  let month=1;
  
  for(let i=0;i<12;i++){
    if(currentDay<=monthDays[i]){
      month=i+1;
      break;
    }
    currentDay-=monthDays[i];
  }
  
  return{
    year:hijriYear,
    month:month,
    day:Math.max(1,Math.min(currentDay,monthDays[month-1]))
  };
}

function updateDateTime(){
  const now=new Date();
  const currentMinute=now.getMinutes();
  showHijri=currentMinute%2===1;
  
  if(showHijri){
    const hijriDate=toHijri(now);
    const hijriMonths=['Muharram','Safar','Rabiul Awwal','Rabiul Akhir','Jumadil Awwal','Jumadil Akhir','Rajab','Syaban','Ramadhan','Syawal','Dzulqaidah','Dzulhijjah'];
    document.getElementById('currentDate').textContent=`${hijriDate.day} ${hijriMonths[hijriDate.month-1]} ${hijriDate.year}H`;
  }else{
    document.getElementById('currentDate').textContent=now.toLocaleDateString('en-US',{year:'numeric',month:'short',day:'numeric',timeZone:'Asia/Jakarta'});
  }
  
  document.getElementById('currentTime').textContent=now.toLocaleTimeString('en-US',{hour12:false,timeZone:'Asia/Jakarta'});
  document.getElementById('currentDay').textContent=dayNames[now.getDay()];
}

function toggleModal(){
  const modal=document.getElementById('statsModal');
  const overlay=document.getElementById('blurOverlay');
  const statsBtn=document.getElementById('statsBtn');
  const isVisible=modal.classList.contains('show');
  
  if(isVisible){
    closeModal();
  }else{
    modal.classList.add('show');
    overlay.classList.add('active');
    statsBtn.classList.add('active');
    refreshChart(activeChart);
  }
}

function closeModal(){
  document.getElementById('statsModal').classList.remove('show');
  document.getElementById('blurOverlay').classList.remove('active');
  document.getElementById('statsBtn').classList.remove('active');
}

function switchChart(chartType){
  document.querySelectorAll('.chart-btn').forEach(btn=>{
    btn.classList.toggle('active',btn.getAttribute('data-chart')===chartType);
  });
  
  document.querySelectorAll('.chart-img').forEach(img=>{
    img.style.display='none';
  });
  
  const targetImg=document.getElementById(chartType);
  if(targetImg){
    activeChart=chartType;
    targetImg.style.display='block';
    refreshChart(chartType);
  }
}

function refreshChart(chartType){
  const container=document.getElementById('imageContainer');
  const img=document.getElementById(chartType);
  if(!img)return;
  
  container.classList.add('loading');
  const timestamp=Date.now();
  const baseSrc=img.src.split('?')[0];
  img.src=`${baseSrc}?t=${timestamp}`;
  
  const handleLoad=()=>{
    container.classList.remove('loading');
    img.removeEventListener('load',handleLoad);
    img.removeEventListener('error',handleError);
  };
  
  const handleError=()=>{
    container.classList.remove('loading');
    showToast('Failed to load chart','error');
    img.removeEventListener('load',handleLoad);
    img.removeEventListener('error',handleError);
  };
  
  img.addEventListener('load',handleLoad);
  img.addEventListener('error',handleError);
}

function showToast(message,type,duration=3000){
  const toast=document.getElementById('toast');
  const toastMsg=document.getElementById('toastMsg');
  
  if(toast.timeoutId)clearTimeout(toast.timeoutId);
  
  toastMsg.textContent=message;
  toast.className=`toast show ${type}`;
  
  toast.timeoutId=setTimeout(()=>{
    toast.classList.remove('show');
  },duration);
}

document.addEventListener('keydown',function(e){
  if(e.key==='Escape')closeModal();
  if((e.key==='t'||e.key==='T')&&!e.ctrlKey&&!e.altKey)document.getElementById('themeBtn').click();
  if((e.key==='s'||e.key==='S')&&!e.ctrlKey&&!e.altKey)toggleModal();
});
</script>
</body>
</html>